<!-- === Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„: Ù†Øµ + ØµÙˆØª + Ù…Ø±Ø¦ÙŠ + Ø±ÙˆØ§Ø¨Ø· === -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÙˆÙƒÙŠÙ„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙƒÙŠ</title>
  <!-- === Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„: Ù†Øµ + ØµÙˆØª + Ù…Ø±Ø¦ÙŠ + Ø±ÙˆØ§Ø¨Ø· === -->
  <style>
    :root{
      --brand:#0544b0; --brand2:#0544b0; --bg:#f9f6ff; --card:#fff; --text:#222;
    }
    .chatbot-icon{
      position:fixed; bottom:90px; left:20px; width:60px; height:60px; border-radius:50%;
      background:var(--brand); color:#fff; display:flex; align-items:center; justify-content:center;
      font-size:28px; box-shadow:0 6px 16px rgba(0,0,0,.15); cursor:pointer; z-index:9999; transition:.25s;
    }
    .chatbot-icon:hover{ transform:scale(1.08); background:var(--brand2); }

    .chatbot-window{
      position:fixed; bottom:160px; left:20px; width:340px; max-width:92vw; display:none; flex-direction:column;
      background:var(--card); border-radius:16px; box-shadow:0 14px 34px rgba(0,0,0,.18); overflow:hidden; z-index:9999;
      transform:translateY(12px); opacity:0; transition:transform .25s ease, opacity .25s ease;
    }
    .chatbot-window.open{ display:flex; transform:translateY(0); opacity:1; }
    .chatbot-header{
      background:linear-gradient(135deg,var(--brand),var(--brand2)); color:#fff; padding:12px 12px;
      display:flex; align-items:center; justify-content:space-between; gap:8px; font-weight:700;
    }
    .chatbot-actions{ display:flex; gap:6px; }
    .chatbot-btn{
      border:none; background:rgba(255,255,255,.18); color:#fff; padding:6px 10px; border-radius:10px; cursor:pointer; font-size:13px;
    }
    .chatbot-close{ border:none; background:transparent; color:#fff; font-size:18px; cursor:pointer; }

    .chatbot-messages{ height:260px; overflow-y:auto; padding:12px; background:#fff; font-family:"Cairo",sans-serif; direction:rtl; }
    .msg{ margin:8px 0; line-height:1.6; font-size:14px; color:var(--text); }
    .msg.me{ text-align:left; }
    .bubble{
      display:inline-block; padding:8px 10px; border-radius:12px; max-width:92%;
      background:#f3e8ff; border:1px solid #eadbff;
    }
    .msg.me .bubble{ background:#eef7ff; border-color:#d8ecff; }

    .media{
      margin-top:6px; border-radius:12px; overflow:hidden; border:1px solid #eee;
    }
    .media img, .media video{ width:100%; height:auto; display:block; }

    .quickbar{ display:flex; flex-wrap:wrap; gap:6px; padding:8px 12px; border-top:1px dashed #eee; background:#fcfbff; }
    .quickbar button{
      border:1px solid #e7e3f3; background:#fff; border-radius:999px; padding:6px 10px; cursor:pointer; font-size:12px;
    }

    .chatbot-input{ display:flex; gap:6px; padding:10px; border-top:1px solid #eee; background:#fff; }
    .chatbot-input input{
      flex:1; border:1px solid #e7e3f3; border-radius:12px; padding:8px 10px; outline:none;
    }
    .chatbot-input .send, .chatbot-input .mic, .chatbot-input .tts{
      border:none; border-radius:12px; padding:8px 10px; cursor:pointer; background:var(--brand); color:#fff; font-size:14px;
    }
    .chatbot-input .mic.listening{ background:#e11d48; } /* Ø£Ø­Ù…Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ */
    .note{ font-size:12px; color:#666; padding:6px 12px; background:#fff8; }

  </style>
</head>
<body>

  <!-- Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© -->
  <div class="chatbot-icon" id="cbIcon" title="ÙˆÙƒÙŠÙ„ Ø§Ù„Ø¯Ø¹Ù…">ğŸ’¬</div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ÙˆÙƒÙŠÙ„ -->
  <div class="chatbot-window" id="cbWin" dir="rtl">
    <div class="chatbot-header">
      <span>ÙˆÙƒÙŠÙ„ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…ÙˆØ¯ÙŠÙˆÙ„Ø§Øª</span>
      <div class="chatbot-actions">
        <button class="chatbot-btn" id="cbToggleTTS" title="ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù†Ø·Ù‚">ğŸ”Š Ø§Ù„Ù†Ø·Ù‚</button>
        <button class="chatbot-close" id="cbClose" title="Ø¥ØºÙ„Ø§Ù‚">âœ–</button>
      </div>
    </div>

    <div class="chatbot-messages" id="cbMsgs">
      <div class="msg">
        <div class="bubble">
          Ø£Ù‡Ù„Ø§Ù‹ ğŸ‘‹ Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ Ù„ØªÙ‚Ø¯ÙŠÙ… Ø§Ù„Ø¯Ø¹Ù… Ù„Ùƒ. Ø§Ø³Ø£Ù„Ù†ÙŠ Ø¹Ù† <b>Ø§Ù„ØªØ­ÙŠØ©ØŒ Ø§Ù„Ø®Ø·Ø©ØŒ Ø§Ù„ØªÙ†ÙÙŠØ°ØŒ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…ØŒ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯</b>â€¦ ÙˆØ³Ø£Ø¹Ø·ÙŠÙƒ Ù†ØµÙ‹Ø§ + ØµÙˆØª + Ø£Ù…Ø«Ù„Ø© Ù…Ø±Ø¦ÙŠØ© ÙˆØ±ÙˆØ§Ø¨Ø·.
        </div>
      </div>
    </div>

    <div class="quickbar" id="cbQuick">
      <button data-q="Ø¹Ø§ÙŠØ²Ø© Ø®Ø·Ø© ØªÙ†ÙÙŠØ° Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©">Ø®Ø·Ø© ØªÙ†ÙÙŠØ°</button>
      <button data-q="Ø¥Ø²Ø§ÙŠ Ø£Ø­Ø³Ù† Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠØŸ">Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø¯ÙŠÙ…ÙŠ</button>
      <button data-q="Ø§ÙŠÙ‡ Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…ØŸ">Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>
      <button data-q="Ø£Ø¯ÙˆØ§Øª Ù„Ù„Ø¥Ù†ØªØ§Ø¬ Ø§Ù„Ø±Ù‚Ù…ÙŠ">Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬</button>
    </div>

    <div class="chatbot-input">
      <input type="text" id="cbInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒâ€¦">
      <button class="mic" id="cbMic" title="ØªØ­Ø¯Ø«">ğŸ¤</button>
      <button class="send" id="cbSend">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
    <div class="note" id="cbNote" style="display:none;"></div>
  </div>


<script>
  
/* ===== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ ===== */
const RESPONSES = [
  { key: /Ø®Ø·Ø©|Ø¬Ø¯ÙˆÙ„|ØªÙ†Ø¸ÙŠÙ…/gi,
    text: "Ù‚Ø³Ù‘Ù… Ù…Ø´Ø±ÙˆØ¹Ùƒ Ù„Ù…Ù‡Ø§Ù… ØµØºÙŠØ±Ø© (ØªØ­Ù„ÙŠÙ„â†’ØªØµÙ…ÙŠÙ…â†’Ø¥Ù†ØªØ§Ø¬â†’Ù…Ø±Ø§Ø¬Ø¹Ø©â†’ØªØ³Ù„ÙŠÙ…). Ø®ØµØµ Ø£Ù‡Ø¯Ø§Ù Ø£Ø³Ø¨ÙˆØ¹ÙŠØ© ÙˆÙ…Ø¤Ø´Ø±Ø§Øª Ù‚ÙŠØ§Ø³ Ø¨Ø³ÙŠØ·Ø©.",
    media: null,
    links: [{label:"Ù‚Ø§Ù„Ø¨ Ø®Ø·Ø© ØªÙ†ÙÙŠØ°", href:"#"}, {label:"Ù‚Ø§Ø¦Ù…Ø© Ù…Ù‡Ø§Ù… Ø¬Ø§Ù‡Ø²Ø©", href:"#"}]
  },
  { key: /ØªÙ†ÙÙŠØ°|Ø¨Ø±Ù…Ø¬Ø©|Ø¥Ù†ØªØ§Ø¬/gi,
    text: "Ø§Ø¨Ø¯Ø£ Ø¨Ø£Ø¨Ø³Ø· Ù†Ø³Ø®Ø© Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø¹Ù…Ù„ ØŒ ÙˆØ«Ù‘Ù‚ Ù„Ù‚Ø·Ø§Øª Ø§Ù„ØªÙ‚Ø¯Ù…ØŒ ÙˆØ§Ø·Ù„Ø¨ÙŠ ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© Ù…Ø¨ÙƒØ±Ø©.",
    media: null,
    links: [{label:"Ø¯Ù„ÙŠÙ„ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø¥Ù†ØªØ§Ø¬", href:"#"}, {label:"Ù†Ù…ÙˆØ°Ø¬ ØªÙˆØ«ÙŠÙ‚", href:"#"}]
  },
  { key: /ØªÙ‚ÙŠÙŠÙ…|Ø±ÙˆØ¨Ø±Ùƒ|Ø¯Ø±Ø¬Ø§Øª/gi,
    text: "Ø§Ø³ØªØ®Ø¯Ù… ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ù‚Ø±Ø§Ù† Ù…Ø¨ÙƒØ±Ù‹Ø§ + ØªÙ‚ÙŠÙŠÙ… Ø°Ø§ØªÙŠ ÙˆÙÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ù…Ø¹Ø§ÙŠÙŠØ± (ÙˆØ¶ÙˆØ­ Ø§Ù„Ø£Ù‡Ø¯Ø§ÙØŒ Ø§Ù„Ø¯Ù‚Ø©ØŒ Ø§Ù„Ø¹Ø±Ø¶).",
    media: null,
    links: [{label:"Ù†Ù…ÙˆØ°Ø¬ ØªÙ‚ÙŠÙŠÙ… Ø°Ø§ØªÙŠ", href:"#"}, {label:"Ø±ÙˆØ¨Ø±Ùƒ Ø§Ù„Ø¹Ø±Ø¶", href:"#"}]
  },
  { key: /Ø¹Ø±Ø¶|Ø¨Ø±Ø²Ù†ØªÙŠØ´Ù†|Ø´Ø±Ø§Ø¦Ø­/gi,
    text: "Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ 10-12 Ø´Ø±ÙŠØ­Ø© ÙˆØ§Ø¶Ø­Ø©ØŒ Ø®Ø· ÙƒØ¨ÙŠØ±ØŒ ØµÙˆØ± Ø¯Ø§Ø¹Ù…Ø©ØŒ ÙˆØªØ¯Ø±ÙŠØ¨ Ù…Ø³Ø¨Ù‚ Ù…Ø¹ Ø¶Ø¨Ø· Ø§Ù„ÙˆÙ‚Øª.",
    media: null,
    links: [{label:"Ù‚Ø§Ù„Ø¨ Ø´Ø±Ø§Ø¦Ø­", href:"#"}, {label:"Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø¥Ù„Ù‚Ø§Ø¡", href:"#"}]
  },
  { key: /ØªØ³Ù„ÙŠÙ…|Ù…ÙˆØ¹Ø¯|Ù†Ù‡Ø§Ø¦ÙŠ/gi,
    text: "ØªØ£ÙƒØ¯ Ù…Ù†: Ù†Ø³Ø®Ø© Ù†Ù‡Ø§Ø¦ÙŠØ© + ØªÙ‚Ø±ÙŠØ± Ù…Ù†Ø³Ù‚ (Ù…Ù„Ø®Øµ/Ù…Ù‚Ø¯Ù…Ø©/Ù…Ù†Ù‡Ø¬ÙŠØ©/Ù†ØªØ§Ø¦Ø¬/ØªÙˆØµÙŠØ§Øª) + Ù…Ù„Ø§Ø­Ù‚ ÙˆÙ…Ø±Ø§Ø¬Ø¹ + Ù†Ø³Ø®Ø© Ù„Ù„Ø¹Ø±Ø¶.",
    media: null,
    links: [{label:"Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„ØªØ³Ù„ÙŠÙ…", href:"#"}, {label:"Ù‚Ø§Ø¦Ù…Ø© ØªØ­Ù‚Ù‚ Ù†Ù‡Ø§Ø¦ÙŠØ©", href:"#"}]
  },

  /* ====== Ø§Ù„ØªØ­ÙŠØ§Øª Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© ====== */
  { key: /Ø§Ù„Ø³Ù„Ø§Ù…\s*Ø¹Ù„ÙŠÙƒÙ…/i,
    text: [
      "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡ ğŸŒ¸",
      "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ğŸŒ· ÙƒÙŠÙ Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯ÙƒØŸ",
      "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù… ğŸ™Œ Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ"
    ],
    media: null, links: [] },

  { key: /Ù…Ø±Ø­Ø¨Ø§|Ø§Ù‡Ù„Ø§|Ù‡Ø§ÙŠ/i,
    text: [
      "Ø£Ù‡Ù„Ø§Ù‹ Ø¨ÙŠÙƒ ğŸ‘‹ ÙŠØ³Ø¹Ø¯Ù†ÙŠ Ø£Ø³Ø§Ø¹Ø¯Ùƒ.",
      "Ù…Ø±Ø­Ø¨Ù‹Ø§ ğŸ™ ÙƒÙŠÙÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ",
      "Ù‡Ø§ÙŠ ğŸŒŸ Ø¬Ø§Ù‡Ø²/Ø© Ù†Ø¨Ø¯Ø£ØŸ"
    ],
    media: null, links: [] },

  { key: /ØµØ¨Ø§Ø­\s*Ø§Ù„Ø®ÙŠØ±/i,
    text: [
      "ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± ÙˆØ§Ù„Ø³Ø±ÙˆØ± â˜€ï¸",
      "ØµØ¨Ø§Ø­ Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„ÙŠØ§Ø³Ù…ÙŠÙ† ğŸŒ¹",
      "ØµØ¨Ø§Ø­ Ø§Ù„Ù†Ø´Ø§Ø· ÙˆØ§Ù„Ø·Ø§Ù‚Ø© ğŸ’ª"
    ],
    media: null, links: [] },

  { key: /Ù…Ø³Ø§Ø¡\s*Ø§Ù„Ø®ÙŠØ±/i,
    text: [
      "Ù…Ø³Ø§Ø¡ Ø§Ù„ÙˆØ±Ø¯ ÙˆØ§Ù„ÙŠØ§Ø³Ù…ÙŠÙ† ğŸŒ™",
      "Ù…Ø³Ø§Ø¡ Ø§Ù„ÙÙ„ ğŸŒ·",
      "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ± ğŸ™Œ ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ…ÙƒØŸ"
    ],
    media: null, links: [] }
];

/* Ø±Ø¯ Ø§ÙØªØ±Ø§Ø¶ÙŠ */
const FALLBACK = {
  text: "ÙˆØ¶Ø­Ù‘ Ø³Ø¤Ø§Ù„Ùƒ Ø¨ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ© (Ø®Ø·Ø©ØŒ ØªÙ†ÙÙŠØ°ØŒ ØªÙ‚ÙŠÙŠÙ…ØŒ Ø¹Ø±Ø¶ØŒ ØªØ³Ù„ÙŠÙ…) Ø¹Ø´Ø§Ù† Ø£Ù‚Ø¯Ø± Ø£Ø³Ø§Ø¹Ø¯Ùƒ Ø¨Ø¯Ù‚Ø© ğŸ™Œ",
  media: null, links:[{label:"ÙƒÙ„ Ø§Ù„Ù…ÙˆØ§Ø±Ø¯", href:"#all"}]
};

/* Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ø·Ù‚ (Ù‡Ù†Ø®Ù„Ù‘ÙŠÙ‡ ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·) */
let TTS_ENABLED = false;

/* ===== Ø¹Ù†Ø§ØµØ± DOM ===== */
const icon   = document.getElementById('cbIcon');
const win    = document.getElementById('cbWin');
const closeB = document.getElementById('cbClose');
const input  = document.getElementById('cbInput');
const send   = document.getElementById('cbSend');
const msgs   = document.getElementById('cbMsgs');
const quick  = document.getElementById('cbQuick');
const micBtn = document.getElementById('cbMic');
const note   = document.getElementById('cbNote');
const ttsBtn = document.getElementById('cbToggleTTS'); // Ù‡Ù†Ø³ØªØ®Ø¯Ù… Ù†ÙØ³ Ø§Ù„Ø²Ø± ÙƒÙ€ "Ø§Ù‚Ø±Ø£ Ø¢Ø®Ø± Ø±Ø¯"

/* ===== ÙØªØ­/ØºÙ„Ù‚ ===== */
icon.addEventListener('click', () => { win.classList.add('open'); });
closeB.addEventListener('click', () => { win.classList.remove('open'); });

/* ===== Ø£Ø²Ø±Ø§Ø± Ø³Ø±ÙŠØ¹Ø© ===== */
quick.addEventListener('click', (e)=>{
  if(e.target.tagName.toLowerCase()==='button'){
    const q = e.target.getAttribute('data-q') || e.target.textContent;
    addMessage(q, true);
    respond(q);
  }
});

/* ===== Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¯ÙˆÙŠ ===== */
send.addEventListener('click', () => {
  const q = input.value.trim();
  if(!q) return;
  addMessage(q, true);
  input.value = '';
  respond(q);
});
input.addEventListener('keypress', e => { if(e.key==='Enter') send.click(); });

/* ===== Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© ===== */
function addMessage(text, me=false, htmlExtras=null){
  const wrap = document.createElement('div');
  wrap.className = 'msg' + (me ? ' me' : '');
  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.textContent = text;
  wrap.appendChild(bubble);

  // Ù…Ø­ØªÙˆÙ‰ Ù…Ø±Ø¦ÙŠ/Ø±ÙˆØ§Ø¨Ø· Ø¥Ù† ÙˆØ¬Ø¯Øª
  if(htmlExtras){
    if(htmlExtras.media){
      const m = document.createElement('div'); m.className='media';
      if(htmlExtras.media.type==='img'){
        const img=document.createElement('img'); img.src=htmlExtras.media.src; img.alt=htmlExtras.media.alt||'';
        m.appendChild(img);
      }else if(htmlExtras.media.type==='video'){
        const v=document.createElement('video'); v.src=htmlExtras.media.src; v.controls=true; m.appendChild(v);
      }
      wrap.appendChild(m);
    }
    if(htmlExtras.links && htmlExtras.links.length){
      const linksDiv = document.createElement('div'); linksDiv.style.marginTop='6px';
      htmlExtras.links.forEach(l=>{
        const a=document.createElement('a');
        a.href=l.href; a.textContent='ğŸ”— '+l.label; a.target='_blank';
        a.style.display='inline-block'; a.style.margin='4px 6px 0 0';
        a.style.fontSize='12px'; a.style.textDecoration='none';
        a.style.color='#6a0dad'; a.style.borderBottom='1px dashed #cdb7ff';
        linksDiv.appendChild(a);
      });
      wrap.appendChild(linksDiv);
    }
  }

  msgs.appendChild(wrap);
  msgs.scrollTop = msgs.scrollHeight;
}

/* ===== Ù…Ù†Ø·Ù‚ Ø§Ù„Ø±Ø¯ ===== */
function findResponse(q){
  for(const r of RESPONSES){
    // Ù…Ù‡Ù…: Reset Ù„Ù„Ù€ regex Ø¹Ø´Ø§Ù† /g Ù…Ø§ ÙŠØ¨Ù‡Ø¯Ù„ .test Ø¹Ø¨Ø± Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡Ø§Øª
    if (r.key && typeof r.key.lastIndex === 'number') r.key.lastIndex = 0;
    if(r.key.test(q)) return r;
  }
  return FALLBACK;
}

function respond(q){
  const r = findResponse(q);
  let reply = r.text;

  // Ù„Ùˆ Ø§Ù„Ø±Ø¯ Ø¹Ø¨Ø§Ø±Ø© Ø¹Ù† Ù…ØµÙÙˆÙØ©ØŒ Ù†Ø®ØªØ§Ø± ÙˆØ§Ø­Ø¯ Ø¹Ø´ÙˆØ§Ø¦ÙŠ
  if (Array.isArray(r.text)) {
    reply = r.text[Math.floor(Math.random() * r.text.length)];
  }

  addMessage(reply, false, {media:r.media, links:r.links});
  // Ù„Ø§ Ù†Ø·Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠ
}

/* ===== Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ (ÙŠØ¯ÙˆÙŠ ÙÙ‚Ø·) ===== */
function speak(text){
  try{
    if(!('speechSynthesis' in window)) { showNote('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ù†Ø·Ù‚ Ø§Ù„ØµÙˆØªÙŠ.'); return; }
    const u = new SpeechSynthesisUtterance(text);
    const setVoice = () => {
      const voices = speechSynthesis.getVoices();
      const ar = voices.find(v=>/ar|arabic/i.test(v.lang || v.name));
      if(ar) u.voice = ar;
      u.lang = ar ? ar.lang : 'ar-SA';
      speechSynthesis.cancel();
      speechSynthesis.speak(u);
    };
    if (speechSynthesis.getVoices().length === 0) {
      speechSynthesis.addEventListener('voiceschanged', setVoice, { once:true });
    } else {
      setVoice();
    }
  }catch(e){ showNote('ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª.'); }
}

// Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø²Ø± "ğŸ”Š Ø§Ù„Ù†Ø·Ù‚" Ù„Ù‚Ø±Ø§Ø¡Ø© Ø¢Ø®Ø± Ø±Ø¯ Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ ÙÙ‚Ø·
ttsBtn.textContent = 'ğŸ”Š Ø§Ù„Ù†Ø·Ù‚';
ttsBtn.title = 'Ø§Ù‚Ø±Ø£ Ø¢Ø®Ø± Ø±Ø¯ ÙÙ‚Ø·';
ttsBtn.addEventListener('click', ()=>{
  // Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ù…Ù† Ø§Ù„ÙˆÙƒÙŠÙ„ (msg Ø¨Ø¯ÙˆÙ† .me)
  const bubbles = msgs.querySelectorAll('.msg:not(.me) .bubble');
  if(!bubbles.length){ showNote('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ Ù„Ù‚Ø±Ø§Ø¡ØªÙ‡.'); return; }
  const lastText = bubbles[bubbles.length - 1].textContent.trim();
  if(lastText) speak(lastText);
});

/* ===== Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØª (Speech-to-Text) ===== */
let recognition = null;
if('webkitSpeechRecognition' in window || 'SpeechRecognition' in window){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SR();
  recognition.lang = 'ar-SA';
  recognition.interimResults = false;
  recognition.maxAlternatives = 1;

  recognition.onstart = ()=> { micBtn.classList.add('listening'); micBtn.textContent='âºï¸'; showNote('Ø£Ø³ØªÙ…Ø¹ Ø§Ù„Ø¢Ù†â€¦'); };
  recognition.onend   = ()=> { micBtn.classList.remove('listening'); micBtn.textContent='ğŸ¤'; hideNote(); };
  recognition.onerror = (e)=> { showNote('ØªØ¹Ø°Ø± Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹: '+ (e.error||'')); };

  recognition.onresult = (e)=>{
    const text = e.results[0][0].transcript;
    input.value = text;
    send.click();
  };
}else{
  micBtn.disabled = true; micBtn.style.opacity=.6; micBtn.title='ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­';
}

micBtn.addEventListener('click', ()=>{
  if(!recognition){ showNote('Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ø¹Ù„Ù‰ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­.'); return; }
  try{ recognition.start(); }catch{}
});

/* ===== Ù…Ù„Ø§Ø­Ø¸Ø§Øª ØµØºÙŠØ±Ø© ===== */
function showNote(t){ note.style.display='block'; note.textContent=t; }
function hideNote(){ note.style.display='none'; }
</script>
<!-- === Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙˆÙƒÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ø´Ø§Ù…Ù„ === -->

  
</body>
</html>
